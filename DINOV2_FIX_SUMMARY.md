# DINOv2 æ•°æ®æµ Pipeline ä¿®å¤æ€»ç»“

## ðŸ”´ å‘çŽ°çš„å…³é”®é—®é¢˜

æ ¹æ®ä½ æœ‹å‹çš„ GPT åˆ†æžï¼Œå‘çŽ°äº†**ä¸¥é‡çš„å®žçŽ°é”™è¯¯**ï¼š

### é—®é¢˜ 1: Global Crop Scale é”™è¯¯
- **å½“å‰å®žçŽ°**: `scale=(0.2, 1.0)` âŒ
- **DINOv2 å®˜æ–¹**: `scale=(0.4, 1.0)` âœ…
- **å½±å“**: Crop èŒƒå›´å¤ªå¤§ï¼Œå¯èƒ½è£å‰ªæŽ‰å¤ªå¤šå†…å®¹

### é—®é¢˜ 2: æ²¡æœ‰ Local Crops
- **å½“å‰å®žçŽ°**: åªæœ‰ 2 ä¸ª global views âŒ
- **DINOv2 å®˜æ–¹**: 2 ä¸ª global + 6-10 ä¸ª local crops âœ…
- **å½±å“**: ç¼ºå°‘ multi-crop çš„å…³é”®ç»„ä»¶

### é—®é¢˜ 3: Local Crop å°ºå¯¸é”™è¯¯
- **å½“å‰å®žçŽ°**: `local_crop_size = img_size // 3` (å½“ img_size=96 æ—¶ï¼Œåªæœ‰ 32) âŒ
- **DINOv2 å®˜æ–¹**: `local_crop_size = 96` âœ…
- **å½±å“**: Local crops å¤ªå°ï¼Œæ— æ³•æä¾›æœ‰æ•ˆä¿¡æ¯

### é—®é¢˜ 4: Local Crop Scale é”™è¯¯
- **å½“å‰å®žçŽ°**: `scale=(0.05, 0.2)` âŒ
- **DINOv2 å®˜æ–¹**: `scale=(0.05, 0.4)` âœ…
- **å½±å“**: Crop èŒƒå›´å¤ªå°

## âœ… å·²ä¿®å¤çš„å†…å®¹

### 1. ä¿®å¤äº† `build_two_view_augment` å‡½æ•°
- âœ… Global crop scale: `(0.2, 1.0)` â†’ `(0.4, 1.0)`
- âœ… æ·»åŠ äº† local crops æ”¯æŒï¼ˆé»˜è®¤ 8 ä¸ªï¼‰
- âœ… Local crop size: `96`ï¼ˆä¸æ˜¯ `img_size // 3`ï¼‰
- âœ… Local crop scale: `(0.05, 0.4)`
- âœ… æ ¹æ®æ–¹æ³•ç±»åž‹è‡ªåŠ¨é€‰æ‹©å¢žå¼ºç­–ç•¥

### 2. ä¿®å¤äº† `load_dino_data` å‡½æ•°
- âœ… æ·»åŠ äº† `method` å‚æ•°
- âœ… æ·»åŠ äº† `num_local_crops` å‚æ•°
- âœ… è‡ªåŠ¨ä¸º DINOv2 å¯ç”¨ multi-crop

### 3. ä¿®å¤äº† `train.py`
- âœ… è‡ªåŠ¨æ£€æµ‹æ–¹æ³•ç±»åž‹
- âœ… ä¸º DINOv2 è‡ªåŠ¨è®¾ç½® 8 ä¸ª local crops

## ðŸ“Š DINOv2 å®˜æ–¹ Multi-Crop è§„èŒƒ

| ç±»åž‹ | æ•°é‡ | å°ºå¯¸ | Crop Scale | ç”¨é€” |
|------|------|------|------------|------|
| Global crops | 2 | 224 | (0.4, 1.0) | Teacher + Student |
| Local crops | 6-10 | 96 | (0.05, 0.4) | Student only |

**æ³¨æ„**: å¦‚æžœä½¿ç”¨ `img_size=96`ï¼Œglobal crops ä¹Ÿä¼šæ˜¯ 96ï¼ˆè€Œä¸æ˜¯ 224ï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚

## ðŸ§ª éªŒè¯æ­¥éª¤

è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ä¿®å¤ï¼š

```bash
python check_data_pipeline.py
```

è¿™ä¼šæ£€æŸ¥ï¼š
1. Views æ•°é‡æ˜¯å¦æ­£ç¡®ï¼ˆ2 global + 8 local = 10ï¼‰
2. Views å°ºå¯¸æ˜¯å¦æ­£ç¡®
3. æ•°å€¼èŒƒå›´æ˜¯å¦æ­£å¸¸
4. æ˜¯å¦æœ‰ NaN/Inf

## ðŸš€ ä½¿ç”¨ä¿®å¤åŽçš„ä»£ç 

çŽ°åœ¨å¯ä»¥ç›´æŽ¥ä½¿ç”¨åŽŸæ¥çš„è®­ç»ƒå‘½ä»¤ï¼Œä»£ç ä¼šè‡ªåŠ¨ï¼š
- æ£€æµ‹åˆ° `--method dinov2`
- ä½¿ç”¨æ­£ç¡®çš„ global crop scale `(0.4, 1.0)`
- ç”Ÿæˆ 8 ä¸ª local crops
- ä½¿ç”¨æ­£ç¡®çš„ local crop size å’Œ scale

**æ— éœ€ä¿®æ”¹è®­ç»ƒå‘½ä»¤ï¼**

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å›¾åƒå°ºå¯¸**: å¦‚æžœä½¿ç”¨ `img_size=96`ï¼Œglobal crops ä¹Ÿä¼šæ˜¯ 96ï¼ˆä¸æ˜¯ 224ï¼‰
   - è¿™æ˜¯ä¸ºäº†å…¼å®¹æ€§
   - å¦‚æžœå¯èƒ½ï¼Œå»ºè®®ä½¿ç”¨ `img_size=224` ä»¥èŽ·å¾—æœ€ä½³æ•ˆæžœ

2. **è®¡ç®—èµ„æº**: Multi-crop ä¼šå¢žåŠ è®¡ç®—é‡
   - 2 global + 8 local = 10 ä¸ª views
   - æ¯ä¸ª batch éœ€è¦å¤„ç† 10 å€çš„æ•°æ®
   - å¯èƒ½éœ€è¦è°ƒæ•´ batch size

3. **å†…å­˜**: Local crops ä¼šå¢žåŠ å†…å­˜ä½¿ç”¨
   - å¦‚æžœå†…å­˜ä¸è¶³ï¼Œå¯ä»¥å‡å°‘ `num_local_crops`ï¼ˆå¦‚ 6 ä¸ªï¼‰

## ðŸ“ˆ é¢„æœŸæ”¹è¿›

ä¿®å¤åŽï¼Œé¢„æœŸä¼šçœ‹åˆ°ï¼š
- âœ… Loss å¼€å§‹æ­£å¸¸ä¸‹é™
- âœ… å‡†ç¡®çŽ‡å¼€å§‹æå‡ï¼ˆ30+ epoch åŽåº”è¯¥ >5%ï¼‰
- âœ… è®­ç»ƒæ›´ç¨³å®š

